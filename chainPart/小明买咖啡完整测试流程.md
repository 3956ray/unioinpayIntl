# â˜• å°æ˜ä¹°å’–å•¡å®Œæ•´æµ‹è¯•æµç¨‹

## ğŸ“‹ æµ‹è¯•æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›äº†å®Œæ•´çš„å°æ˜ä¹°å’–å•¡æ”¯ä»˜æµç¨‹æµ‹è¯•æŒ‡å—ï¼ŒåŒ…å«ä¸¤ç§æ”¯ä»˜æ–¹å¼ï¼š
1. **ç®€å•æ”¯ä»˜** (ä½¿ç”¨ SimpleTokenCollector)
2. **ERC3009 ç­¾åæ”¯ä»˜** (ä½¿ç”¨ ERC3009PaymentCollector)

---

## ğŸ› ï¸ å‰ç½®å‡†å¤‡

### 1. ç¯å¢ƒæ£€æŸ¥
```bash
# ç¡®ä¿åœ¨æ­£ç¡®çš„ç›®å½•
cd chainPart

# æ£€æŸ¥ä¾èµ–
npm list --depth=0
```

### 2. å¯åŠ¨æœ¬åœ°åŒºå—é“¾
```bash
# åœ¨ç»ˆç«¯1ä¸­è¿è¡Œï¼ˆä¿æŒè¿è¡ŒçŠ¶æ€ï¼‰
npx hardhat node
```

**é¢„æœŸè¾“å‡º**: æ˜¾ç¤º10ä¸ªæµ‹è¯•è´¦æˆ·å’Œç§é’¥

---

## ğŸš€ ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€è®¾æ–½éƒ¨ç½²

### æ­¥éª¤ 1: éƒ¨ç½²æ ¸å¿ƒåˆçº¦
```bash
# éƒ¨ç½² RMBToken å’Œ Escrow åˆçº¦
npx hardhat run scripts/deploy-all.js --network localhost
```

**é¢„æœŸè¾“å‡º**:
```
ğŸš€ å¼€å§‹éƒ¨ç½²æ‰€æœ‰åˆçº¦...
âœ… RMBToken éƒ¨ç½²æˆåŠŸ! åœ°å€: 0x...
âœ… Escrow éƒ¨ç½²æˆåŠŸ! åœ°å€: 0x...
âœ… TokenStore å®ç°éƒ¨ç½²æˆåŠŸ! åœ°å€: 0x...
```

### æ­¥éª¤ 2: éªŒè¯åŸºç¡€éƒ¨ç½²
```bash
# éªŒè¯æ‰€æœ‰åˆçº¦éƒ¨ç½²çŠ¶æ€
npx hardhat run scripts/verify-deployment.js --network localhost
```

**é¢„æœŸè¾“å‡º**: æ˜¾ç¤ºæ‰€æœ‰åˆçº¦åœ°å€å’ŒçŠ¶æ€

---


### é€‰é¡¹ A: ERC3009 ç­¾åæ”¯ä»˜æµç¨‹

#### æ­¥éª¤ 3A: éƒ¨ç½² ERC3009PaymentCollector
```bash
npx hardhat run scripts/deploy-erc3009-collector.js --network localhost
```

#### æ­¥éª¤ 4A: æµ‹è¯• ERC3009 ç­¾åæ”¯ä»˜
```bash
npx hardhat run scripts/coffee-payment-erc3009-demo.js --network localhost
```

**é¢„æœŸç»“æœ**:
- âœ… ERC3009 ç­¾åç”ŸæˆæˆåŠŸ
- âœ… æ”¯ä»˜æˆæƒéªŒè¯é€šè¿‡
- âœ… ä»£å¸è½¬è´¦æˆåŠŸ
- âœ… è´¹ç”¨åˆ†é…æ­£ç¡®

---

## â˜• ç¬¬ä¸‰é˜¶æ®µï¼šå®Œæ•´å’–å•¡è´­ä¹°æ¼”ç¤º


### ERC3009 ç­¾åæ”¯ä»˜æ¼”ç¤º (é«˜çº§åŠŸèƒ½)

```bash
# è¿è¡Œ ERC3009 ç­¾åæ”¯ä»˜æ¼”ç¤º
npx hardhat run scripts/coffee-payment-erc3009-demo.js --network localhost
```

**æµ‹è¯•åœºæ™¯**:
- ğŸ‘¤ å°æ˜ (ä»˜æ¬¾äºº)
- â˜• å’–å•¡åº— (æ”¶æ¬¾äºº)
- ğŸ¢ æ“ä½œå‘˜ (è´¹ç”¨æ¥æ”¶è€…)
- ğŸ’° æ”¯ä»˜é‡‘é¢: 10.0 RMB
- ğŸ“Š è´¹ç‡: 2%

**é¢„æœŸæµç¨‹**:
1. ç”Ÿæˆæ”¯ä»˜ä¿¡æ¯å’Œ nonce
2. å°æ˜ç­¾åæˆæƒæ”¯ä»˜
3. æ“ä½œå‘˜æäº¤ç­¾åæ‰§è¡Œæ”¯ä»˜
4. éªŒè¯ ERC3009 ç­¾å
5. æ‰§è¡Œä»£å¸è½¬è´¦
6. ä½™é¢å˜åŒ–:
   - å°æ˜: -10.0 RMB
   - å’–å•¡åº—: +9.8 RMB
   - æ“ä½œå‘˜: +0.2 RMB (æ‰‹ç»­è´¹)

---

## ğŸ§ª ç¬¬å››é˜¶æ®µï¼šå•å…ƒæµ‹è¯•éªŒè¯

### RMBToken åˆçº¦æµ‹è¯•
```bash
npx hardhat test test/RMBToken.test.js --network localhost
```

### Escrow åŠŸèƒ½æµ‹è¯•
```bash
npx hardhat test test/Escrow.functional.test.js --network localhost
```

---

## ğŸ“Š å®Œæ•´æµ‹è¯•é¡ºåºæ€»ç»“

### ğŸ¯ æ¨èæµ‹è¯•é¡ºåº (æ–°æ‰‹)

```bash
# 1. å¯åŠ¨åŒºå—é“¾
npx hardhat node

# 2. éƒ¨ç½²åŸºç¡€åˆçº¦
npx hardhat run scripts/deploy-all.js --network localhost

# 3. éƒ¨ç½²ç®€å•æ”¶é›†å™¨
npx hardhat run scripts/deploy-simple-collector.js --network localhost

# 4. éªŒè¯éƒ¨ç½²
npx hardhat run scripts/verify-deployment.js --network localhost

#57. å•å…ƒæµ‹è¯•
npx hardhat test --network localhost
```

### ğŸš€ é«˜çº§æµ‹è¯•é¡ºåº (ERC3009)

```bash
# 1-4. åŒä¸ŠåŸºç¡€æ­¥éª¤

# 5. éƒ¨ç½² ERC3009 æ”¶é›†å™¨
npx hardhat run scripts/deploy-erc3009-collector.js --network localhost

# 6. ERC3009 ç­¾åæ”¯ä»˜æ¼”ç¤º
npx hardhat run scripts/coffee-payment-erc3009-demo.js --network localhost

# 7. å®Œæ•´éªŒè¯
npx hardhat run scripts/verify-deployment.js --network localhost
```

---

## âœ… æˆåŠŸæ ‡å‡†

### ç®€å•æ”¯ä»˜æˆåŠŸæ ‡å‡†
- [ ] æ‰€æœ‰åˆçº¦éƒ¨ç½²æˆåŠŸ
- [ ] æƒé™æ§åˆ¶æ­£å¸¸å·¥ä½œ
- [ ] ä»£å¸è½¬è´¦æˆåŠŸ
- [ ] è´¹ç”¨è®¡ç®—æ­£ç¡®
- [ ] ä½™é¢æ›´æ–°å‡†ç¡®

### ERC3009 æ”¯ä»˜æˆåŠŸæ ‡å‡†
- [ ] ERC3009 ç­¾åç”ŸæˆæˆåŠŸ
- [ ] ç­¾åéªŒè¯é€šè¿‡
- [ ] æˆæƒæ”¯ä»˜æ‰§è¡ŒæˆåŠŸ
- [ ] nonce è®¡ç®—æ­£ç¡®
- [ ] åŸŸåˆ†ç¦»å™¨åŒ¹é…

---

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. åˆçº¦åœ°å€ä¸åŒ¹é…
**ç°è±¡**: `Error: contract not deployed`
**è§£å†³**: æ£€æŸ¥è„šæœ¬ä¸­çš„åˆçº¦åœ°å€æ˜¯å¦ä¸ºæœ€æ–°éƒ¨ç½²çš„åœ°å€

#### 2. ä½™é¢ä¸è¶³
**ç°è±¡**: `ERC20: transfer amount exceeds balance`
**è§£å†³**: ç¡®ä¿è´¦æˆ·æœ‰è¶³å¤Ÿçš„ä»£å¸ä½™é¢

#### 3. æˆæƒä¸è¶³
**ç°è±¡**: `ERC20: insufficient allowance`
**è§£å†³**: æ£€æŸ¥ä»£å¸æˆæƒé¢åº¦

#### 4. ç­¾åéªŒè¯å¤±è´¥
**ç°è±¡**: `ERC3009: invalid signature`
**è§£å†³**: æ£€æŸ¥ç­¾åå‚æ•°å’ŒåŸŸåˆ†ç¦»å™¨

### é‡ç½®ç¯å¢ƒ
```bash
# é‡å¯åŒºå—é“¾ç½‘ç»œ
Ctrl+C  # åœæ­¢ hardhat node
npx hardhat node  # é‡æ–°å¯åŠ¨

# é‡æ–°éƒ¨ç½²æ‰€æœ‰åˆçº¦
npx hardhat run scripts/deploy-all.js --network localhost
```

---

## ğŸ“ æµ‹è¯•è®°å½•æ¨¡æ¿

```
æµ‹è¯•æ—¥æœŸ: ____
æµ‹è¯•ç¯å¢ƒ: Hardhat æœ¬åœ°ç½‘ç»œ
æµ‹è¯•ç±»å‹: [ ] ç®€å•æ”¯ä»˜ [ ] ERC3009 æ”¯ä»˜

éƒ¨ç½²ç»“æœ:
- RMBToken: ________________
- Escrow: __________________
- Collector: _______________

æµ‹è¯•ç»“æœ:
- [ ] éƒ¨ç½²æˆåŠŸ
- [ ] éªŒè¯é€šè¿‡
- [ ] æ”¯ä»˜æˆåŠŸ
- [ ] ä½™é¢æ­£ç¡®
